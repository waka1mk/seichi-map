<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å››å›½ è–åœ°å·¡ç¤¼ãƒãƒƒãƒ—</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4CAF50">

  <style>
    body { margin: 0; font-family: sans-serif; background: #f5f8f5; }
    header { background: #4CAF50; color: white; padding: 1em; text-align: center; border-radius: 0 0 20px 20px; }
    #map { height: 60vh; width: 95%; border-radius: 20px; margin: 10px auto; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    h2 { margin-left: 10px; color: #333; }
    .tab-content { padding: 1em; }
    .timeline-item { background: white; padding: 10px; border-radius: 10px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .comment-section { background: #f2fff2; border-radius: 10px; padding: 10px; margin-top: 10px; }
    .comment { border-bottom: 1px solid #ccc; padding: 5px 0; }
    .reply { margin-left: 1em; color: #444; }
    input, textarea, button { width: 100%; padding: 0.4em; margin-top: 0.3em; border-radius: 5px; border: 1px solid #ccc; font-size: 0.9em; }
    button { background: #4CAF50; color: white; border: none; cursor: pointer; }
    button:hover { background: #45a049; }
  </style>
</head>
<body>
  <header><h1>å››å›½ è–åœ°å·¡ç¤¼ãƒãƒƒãƒ—</h1></header>

  <div id="map"></div>

  <section id="timelineTab" class="tab-content">
    <h2>ä½œå“ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h2>
    <div id="timeline"></div>
  </section>

  <script src="comments.js"></script>

  <script>
    // --- ãƒ‡ãƒ¢ç”¨ãƒ‡ãƒ¼ã‚¿ï¼ˆåˆå›ã®ã¿æŒ¿å…¥ï¼‰ ---
    if (!localStorage.getItem("posts")) {
      const demoPosts = [
        {
          title: "è¦³éŸ³å¯ºé§…å‰",
          work: "çµåŸå‹å¥ˆã¯å‹‡è€…ã§ã‚ã‚‹",
          pref: "é¦™å·çœŒ",
          lat: 34.1261,
          lng: 133.6612,
          comment: "å‹å¥ˆãŸã¡ã®é€šå­¦ãƒ«ãƒ¼ãƒˆã€‚è–åœ°å·¡ç¤¼ã®å®šç•ªï¼",
          comments: [
            { user: { name: "ã‚†ã†ãªæ¨ã—" }, text: "ã“ã“è¡Œã£ãŸï¼æ¡œã®å­£ç¯€ãŒæœ€é«˜ã§ã™ğŸŒ¸", replies: [] }
          ]
        },
        {
          title: "é“å¾Œæ¸©æ³‰",
          work: "åƒã¨åƒå°‹ã®ç¥éš ã—",
          pref: "æ„›åª›çœŒ",
          lat: 33.8417,
          lng: 132.7657,
          comment: "æ²¹å±‹ã®ãƒ¢ãƒ‡ãƒ«ã¨ã—ã¦æœ‰åãªæ¸©æ³‰è¡—ã€‚",
          comments: [
            { user: { name: "æ¸©æ³‰å¥½ã" }, text: "å¤œã®ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—ãŒç¶ºéº—ï¼", replies: [] }
          ]
        },
        {
          title: "æ¡‚æµœ",
          work: "ç«œã¨ãã°ã‹ã™ã®å§«",
          pref: "é«˜çŸ¥çœŒ",
          lat: 33.5066,
          lng: 133.5736,
          comment: "ãƒ™ãƒ«ãŒæ­Œã†ã‚·ãƒ¼ãƒ³ã®ãƒ­ã‚±åœ°ã«ä¼¼ã¦ã‚‹å ´æ‰€ã€‚",
          comments: []
        }
      ];
      localStorage.setItem("posts", JSON.stringify(demoPosts));
    }

    // --- æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ ---
    let posts = JSON.parse(localStorage.getItem("posts")) || [];

    // --- åœ°å›³è¨­å®š ---
    const map = L.map("map").setView([33.6, 133.6], 8);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "Â© OpenStreetMap contributors"
    }).addTo(map);

    // --- ãƒãƒ¼ã‚«ãƒ¼æç”» ---
    const markersLayer = L.layerGroup().addTo(map);
    function renderMap() {
      markersLayer.clearLayers();
      posts.forEach(post => {
        L.marker([post.lat, post.lng])
          .addTo(markersLayer)
          .bindPopup(`<b>${post.title}</b><br><i>${post.work}</i><br>${post.comment}`);
      });
    }

    // --- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æç”» ---
    function renderTimeline() {
      const container = document.getElementById("timeline");
      container.innerHTML = "";
      posts.forEach((post, idx) => {
        const div = document.createElement("div");
        div.className = "timeline-item";
        div.innerHTML = `
          <b>${post.title}</b> (${post.work})<br>${post.comment}
          <div id="comments-${idx}" class="comment-section"></div>
        `;
        container.appendChild(div);
        renderComments(idx);
      });
    }

    // --- ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºå‘¼ã³å‡ºã— ---
    function renderComments(index) {
      const post = posts[index];
      renderCommentSection(`comments-${index}`, post, index);
    }

    // --- åˆæœŸæç”» ---
    renderMap();
    renderTimeline();
  </script>
</body>
</html>

